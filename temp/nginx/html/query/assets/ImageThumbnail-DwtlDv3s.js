import{d as j,h as T,c as C,l as L,p as X,E as Y,a as x,r as l,w as t,f as n,b as $,n as V,g as u,i as J,t as F,o as _,s as O,k as G,u as N}from"./index-ps4APlwp.js";import{u as A}from"./vampire-squid-D7jZW1fw.js";import{u as H,c as W}from"./constants-Cf8BquGR.js";import{n as U,g as Z}from"./util-C7v2iPfJ.js";import{e as K,Q as ee}from"./QueryRunner-BvdmagcV.js";const te=["src"],ne={key:1},oe=["href"],ae=j({__name:"VideoPlayer",props:{videoUrl:{},mediaType:{},seekTimeSeconds:{}},setup(I){const o=I,m=T(!1),i=T(null),w=C(()=>`${o.videoUrl}#t=${o.seekTimeSeconds}`);L(()=>o.videoUrl,()=>{m.value=!1}),L(()=>o.seekTimeSeconds,()=>{m.value=!1,i.value&&!m.value&&y()});function y(){i.value&&(i.value.currentTime=o.seekTimeSeconds)}function S(){i.value&&!m.value&&(i.value.currentTime=o.seekTimeSeconds)}function d(){m.value=!0}X(()=>{i.value&&(i.value.addEventListener("canplay",S),i.value.addEventListener("seeked",d))}),Y(()=>{i.value&&(i.value.removeEventListener("canplay",S),i.value.removeEventListener("seeked",d))});function R(){i.value&&(document.pictureInPictureElement?document.exitPictureInPicture():i.value.requestPictureInPicture())}return(q,c)=>{const s=l("v-col"),b=l("v-row"),p=l("v-icon"),k=l("v-tooltip"),r=l("v-btn"),e=l("v-container");return _(),x(e,null,{default:t(()=>[n(b,null,{default:t(()=>[n(s,null,{default:t(()=>[o.videoUrl?(_(),$("video",{key:0,id:"video-player",ref_key:"video",ref:i,preload:"auto",controls:"",muted:"",crossorigin:"anonymous",src:o.videoUrl},null,8,te)):V("",!0),o.videoUrl?V("",!0):(_(),$("div",ne,"No web-friendly video available"))]),_:1})]),_:1}),n(b,{align:"center"},{default:t(()=>[n(s,{cols:"1"},{default:t(()=>[n(r,{icon:"mdi-open-in-new",onClick:R},{default:t(()=>[n(p,{icon:"mdi-open-in-new"}),n(k,{activator:"parent",location:"bottom"},{default:t(()=>[...c[0]||(c[0]=[u("Toggle Picture in Picture",-1)])]),_:1})]),_:1})]),_:1}),n(s,null,{default:t(()=>[J("a",{href:w.value,target:"_blank",class:"small-font"},F(w.value),9,oe)]),_:1})]),_:1})]),_:1})}}}),ie=O(ae,[["__scopeId","data-v-5afd9a62"]]),pe=j({__name:"VamVideoPlayer",props:{sourceVideoUri:{},recordedTimestamp:{}},setup(I){const o=I,m=A(),i=G(async()=>o.sourceVideoUri&&o.recordedTimestamp?await m.api.findPreviewMediaByUriAndTimestamp(o.sourceVideoUri,o.recordedTimestamp):null),w=C(()=>i.value?i.value.media.container:"video/mp4");return(y,S)=>N(i)?(_(),x(ie,{key:0,"video-url":N(i).media.uri,"media-type":w.value||"video/mp4","seek-time-seconds":N(i).seekTimeSeconds},null,8,["video-url","media-type","seek-time-seconds"])):V("",!0)}}),se=j({__name:"SaveOptions",setup(I){const o=H(),m=A(),i=()=>{const r=K().api,a=new ee(r).buildQueries(),f=`vars-queries-${U()}.json`,g=JSON.stringify(a,null,2);p(g,f,"application/json")},w=C(()=>o.annotations.length),y=T(!1),S=C(()=>w.value<1e3),d=T(!1);function R(){d.value=!0,console.log("Save Raw");const r=`vars-raw-${U()}.tsv`,e=o.rawQueryResults.join(`
`);p(e,r,"text/tab-separated-values"),d.value=!1}function q(){d.value=!0;const r=`vars-raw-${U()}.json`,e=o.queryResults,a=JSON.stringify(e,null,2);p(a,r,"application/json"),d.value=!1}async function c(){d.value=!0,await k();const r=`vars-${U()}.json`,e=o.annotations,a=JSON.stringify(e,null,2);p(a,r,"application/json"),d.value=!1}async function s(){d.value=!0,await k();const r=`vars-images-${U()}.zip`,e=o.annotations,a=await Z(e);p(a,r,"application/zip"),d.value=!1}async function b(){d.value=!0,await k();const r=`vars-${U()}.tsv`,e=o.annotations,a=W(e);p(a,r,"text/tab-separated-values"),d.value=!1}function p(r,e,a){const f=new Blob([r],{type:a}),g=URL.createObjectURL(f),v=document.createElement("a");v.href=g,v.download=e,document.body.appendChild(v),v.click(),setTimeout(function(){document.body.removeChild(v),window.URL.revokeObjectURL(g)},0)}async function k(){if(y.value){const e=o.annotations.filter(a=>!a.preview_media_uri&&a.video_uri&&a.index_recorded_timestamp).map(async a=>{const f=await m.api.findPreviewMediaByUriAndTimestamp(a.video_uri??"",a.index_recorded_timestamp??"");f&&f.media&&f.media.uri&&(a.preview_media_uri=f.media.uri,a.preview_media_index_seconds=f.seekTimeSeconds??0)});await Promise.all(e)}}return(r,e)=>{const a=l("v-tooltip"),f=l("v-checkbox"),g=l("v-col"),v=l("v-btn"),P=l("v-list-item"),M=l("v-list"),B=l("v-menu"),E=l("v-row"),Q=l("v-progress-circular"),z=l("v-overlay"),h=l("v-container");return _(),x(h,null,{default:t(()=>[n(E,{justify:"end"},{default:t(()=>[n(g,{"align-self":"center"},{default:t(()=>[n(f,{disabled:!S.value,label:"Include preview media",modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=D=>y.value=D)},{default:t(()=>[S.value?(_(),x(a,{key:0,activator:"parent"},{default:t(()=>[...e[1]||(e[1]=[u("Include a preview media url and timestamp in the results. Important for tape and real-time annotations. This will take longer to save.",-1)])]),_:1})):(_(),x(a,{key:1,activator:"parent"},{default:t(()=>[...e[2]||(e[2]=[u("Too many results to include preview media urls. Limit is 1000.",-1)])]),_:1}))]),_:1},8,["disabled","modelValue"])]),_:1}),n(g,{"align-self":"center"},{default:t(()=>[n(v,null,{default:t(()=>[e[15]||(e[15]=u(" Save Results ",-1)),n(B,{location:"top",activator:"parent"},{default:t(()=>[n(M,null,{default:t(()=>[n(P,null,{default:t(()=>[n(v,{onClick:i},{default:t(()=>[e[4]||(e[4]=u(" Save Queries ",-1)),n(a,{activator:"parent",location:"bottom"},{default:t(()=>[...e[3]||(e[3]=[u(" Save the query constraints as a JSON file. ",-1)])]),_:1})]),_:1})]),_:1}),n(P,null,{default:t(()=>[n(v,{onClick:s,hidden:w.value>500},{default:t(()=>[e[6]||(e[6]=u(" Save Images ",-1)),n(a,{activator:"parent",location:"bottom"},{default:t(()=>[...e[5]||(e[5]=[u(" Save the images. ",-1)])]),_:1})]),_:1},8,["hidden"])]),_:1}),n(P,null,{default:t(()=>[n(v,{onClick:R},{default:t(()=>[e[8]||(e[8]=u(" Save Raw as TSV ",-1)),n(a,{activator:"parent",location:"bottom"},{default:t(()=>[...e[7]||(e[7]=[u(" Save the raw query results, as would be returned by a SQL query, as a tab-separated-values file ",-1)])]),_:1})]),_:1})]),_:1}),n(P,null,{default:t(()=>[n(v,{onClick:q},{default:t(()=>[e[10]||(e[10]=u(" Save Raw as JSON ",-1)),n(a,{activator:"parent",location:"bottom"},{default:t(()=>[...e[9]||(e[9]=[u(" Save the raw query results, as would be returned by a SQL query, as a JSON ",-1)])]),_:1})]),_:1})]),_:1}),n(P,null,{default:t(()=>[n(v,{onClick:b},{default:t(()=>[e[12]||(e[12]=u(" Save as TSV ",-1)),n(a,{activator:"parent",location:"bottom"},{default:t(()=>[...e[11]||(e[11]=[u(" Save the query results as tab separated values. Great for importing into Excel. ",-1)])]),_:1})]),_:1})]),_:1}),n(P,null,{default:t(()=>[n(v,{onClick:c},{default:t(()=>[e[14]||(e[14]=u(" Save JSON ",-1)),n(a,{activator:"parent",location:"bottom"},{default:t(()=>[...e[13]||(e[13]=[u(" Save the query results as JSON. Best for importing into other applications or python. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(z,{"model-value":d.value,color:"primary",class:"justify-center align-center"},{default:t(()=>[e[16]||(e[16]=J("div",{class:"big-font"},"Saving ...",-1)),n(Q,{size:128,width:12,color:"blue",indeterminate:""})]),_:1},8,["model-value"])]),_:1})}}}),fe=O(se,[["__scopeId","data-v-bdd70836"]]),le={class:"thumbnail"},re=j({__name:"ImageThumbnail",props:{annotation:{}},setup(I){const o=I,m=T(null),i=T(0),w=T(0),y=A();function S(c,s){c&&(m.value=c,i.value=s.clientX,w.value=s.clientY)}function d(){m.value=null}function R(c){c&&window.open(c,"_blank")?.focus()}function q(c){c.video_uri&&c.index_recorded_timestamp&&y.api.findPreviewMediaByUriAndTimestamp(c.video_uri,c.index_recorded_timestamp).then(s=>{if(s.media&&s.media.uri){const b=s.seekTimeSeconds??0,p=`${s.media.uri}#t=${b}`;window.open(p,"_blank")?.focus()}})}return(c,s)=>{const b=l("v-img"),p=l("v-lazy"),k=l("v-icon");return _(),$("div",le,[o.annotation.image?(_(),x(p,{key:0},{default:t(()=>[o.annotation.image?(_(),x(b,{key:0,src:o.annotation.image,"aspect-ratio":"1","max-width":"250","max-height":"250","min-width":"250","min-height":"250",onMouseenter:s[0]||(s[0]=r=>S(o.annotation.image,r)),onMouseleave:d,onClick:s[1]||(s[1]=()=>R(o.annotation.image))},null,8,["src"])):V("",!0)]),_:1})):V("",!0),n(k,{size:"small",class:"video-icon",onClick:s[2]||(s[2]=()=>q(o.annotation))},{default:t(()=>[...s[3]||(s[3]=[u("mdi-video",-1)])]),_:1})])}}}),_e=O(re,[["__scopeId","data-v-fcc78b84"]]);export{_e as I,fe as S,pe as _};
