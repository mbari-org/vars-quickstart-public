import{j as d,G as u,c as i,H as m,k as c}from"./index-WXnswS6Z.js";import{a as l}from"./util-C4ZhWDef.js";class h{url;maxBytes=1e11;constructor(n){this.url=n}findConcurrentMedia(n){const e=`${this.url}/media/concurrent/${encodeURIComponent(n)}`;return fetch(e,{mode:"cors"}).then(t=>t.json())}findMediaByUri(n){const e=`${this.url}/media/uri/${encodeURIComponent(n)}`;return fetch(e,{mode:"cors"}).then(t=>t.json())}findMediaByVideoReferenceUuid(n){const e=`${this.url}/media/videoreference/${encodeURIComponent(n)}`;return fetch(e,{mode:"cors"}).then(t=>t.json())}findMediaByVideoSequenceName(n){const e=`${this.url}/media/videosequence/${encodeURIComponent(n)}`;return fetch(e,{mode:"cors"}).then(t=>t.json())}findMediaByCameraIdAndTimestamp(n,e){const t=l(e),r=`${this.url}/media/camera/${encodeURIComponent(n)}/${t}`;return fetch(r,{mode:"cors"}).then(o=>o.json())}findSmallestConcurrentMp4(n,e){return console.log("findSmallestConcurrentMp4",n,e),this.findMediaByCameraIdAndTimestamp(n,e).then(t=>t&&t.length>0?t.filter(r=>r.uri.toLowerCase().endsWith(".mp4")).sort((r,o)=>(o.size_bytes??this.maxBytes)-(r.size_bytes??this.maxBytes))[0]:{})}findPreviewMediaByUriAndTimestamp(n,e){return this.findMediaByUri(n).then(t=>this.findSmallestConcurrentMp4(t.camera_id,e)).then(t=>{let r=0;if(t&&t.start_timestamp&&e){const o=new Date(e),a=new Date(t.start_timestamp);r=(o.getTime()-a.getTime())/1e3}return{media:t,seekTimeSeconds:r}})}findVideoByVideoReferenceUuid(n){const e=`${this.url}/videos/videoreference/${encodeURIComponent(n)}`;return fetch(e,{mode:"cors"}).then(t=>t.json())}listVideoSequenceNames(){const n=`${this.url}/videosequences/names`;return fetch(n,{mode:"cors"}).then(e=>e.json())}listCameraPlatforms(){const n=`${this.url}/videosequences/cameras`;return fetch(n,{mode:"cors"}).then(e=>e.json())}findVideoSequenceByName(n){const e=`${this.url}/videosequences/name/${encodeURIComponent(n)}`;return fetch(e,{mode:"cors"}).then(t=>t.json())}}const C=d("vampire-squid",()=>{const s=u(),n=i(()=>m("vampire-squid",s.config)),e=i(()=>new h(n.value)),t=c(async()=>e.value.listVideoSequenceNames()),r=c(async()=>e.value.listCameraPlatforms());return{url:n,api:e,videoSequenceNames:t,cameraPlatforms:r}});export{C as u};
